#
# Stack User Yaml for Geodesy
#
stack_title: {{ env }}Geodesy
keypair: 'geodesy'
autoscaling_units:
  -
    unit_title: WebServices
    asg_config:
      userdata: |
        #!/usr/bin/env bash

        yum -y remove java-1.7.0-openjdk
        yum -y install java-1.8.0-openjdk

        yum -y install tomcat8
        yum -y install postgresql94-server

        yum install -y ruby
        yum install -y wget
        cd /home/ec2-user
        aws s3 cp s3://aws-codedeploy-ap-southeast-2/latest/install . --region ap-southeast-2
        chmod +x ./install
        ./install auto
        service codedeploy-agent start
        service codedeploy-agent status

        pip install credstash
    elb_config:
      unit_hosted_zone_name: 'geodesy.lan'
      protocols:
        - 'HTTP'
      instanceports:
        - '8080'
      loadbalancerports:
        - '8080'
      path2ping: '/'
    dependencies:
     - Db
  -
    unit_title: GeoServer
    dependencies:
     - Db
database_units:
  -
    unit_title: Db
